\chapter{Závěr}
Cílem práce bylo vytvořit nástroje pro diagnostiku integrity dat souborového systému pro OS Linux pro který v současnosti tato podpora neexistuje.\\
Byla provedena analýza úložných řešení používaných v GNU/Linux z hlediska jejich struktury, funkce a možnstií kontroly konzistence. Bylo zjištěno, že nástroje pro kontrolu konzistence jsou zapouzdřeny pod nástrojem \texttt{fskc}, který volá specifické nástroje daného souborového systému. Cílem nástroje \texttt{fsck} je kontrola a oprava metadat (deskriptorů) souborového systému a ne oprava dat samotnách.\\
Během rešerše souborových systémů používaných v OS Linux bylo zjištěno, že neexistuje nástroj \texttt{fsck} pro souborový systém UDF. Proto jsem zvolil tento souborový systém pro další práci. Tomu předcházela analýza tohoto souborového systému z hlediska jeho funkce, použití a přístupu k detekci a korekci chyb.\\
Na tomto základě byly definovány detekovatelné a opravitelné chyby kterými má smysl se zabývat. V zásadě jde o chyby v metadatech souborového systému, protože data samotná jsou chráněna kontrolními a opravnými mechanismy nosného média, typicky pomocí ECC bloků. Metadata jsou na úrovni UDF chráněna kombinací kontroly skutečné a deklarované polohy na médiu, která umožňuje odhalit případné chyby vzniklé při zápisu deskriptoru, kontrolních součtů a CRC, které zajišťují konzistenci deskriptorů jako takovou. Další implementovaný mechanismus souborového systému UDF je redundance klíčových deskriptorů. Tím je zvýšena šance na zachování nejdůležitějších deskriptorů souborového systému. Nutno podotknout, že klíčovými deskriptory jsou myšleny ty, které popisují médiuam jako celek, nikoli deskriptory popisující data. Klíčovou vlastností je vyřešení detekce a následné korekce neukončeného zápisu. Neukončený zápis lze detekovat v deskriptoru \textit{Logical Volume Integrity Descriptor} nebo pomocí ostatních indikátorů jako například lišící se velikost souboru vůči jeho deklarované velikosti. Všechny tyto způsoby jsou detailně popsány v kapitole \ref{ch:definice-chyb}. Poslední částí jsou korekce chyb v deskriptorech stromu souborů. Tyto chyby úzce souvisí s přerušeným zápisem ale mohou vzniknout i jiným způsobem. Jedná se o chyby v unikátním identifikátoru \textit{Unique ID} každého souboru, respektive jeho deskriptorů, a chyby v seriovém čísle tagů deskriptorů.\\
Z tohoto vyplývá, že není možné opravovat chyby, které vznikly poruchou média ale spíše chyby provozní jako například nekorektní odpojení média během zápisu nebo porucha ovladače souborového systému.\\
Práce na nástroji \texttt{udffsck} byla započata v rámci existujícího balíčku \texttt{udftools}, který je součástí všech hlavních distribucí GNU/Linux. Tento balíček byl připravený pro vznik tohoto nástroje ale práce na něm nikdy nezačala. Nástroj \texttt{udffsck} je vytvořen v jazyce C podle standardu C99 s využitím knihovních funkcí poskytnutých operačním systémem \mbox{GNU/Linux}. Nástroj je přeložitelný s minimálními nároky na hostitelský systém stejně jako zbytek balíčku. Více o tomto je v podkapitole \ref{sec:vysledky}.\\
Nástroj \texttt{udffsck} slučuje jak detekční, tak korekční funkci. To znamená, že dokáže nejen detekovat všechny definované chyby na médiích naformátovaných souborovým systémem UDF až do verze standardu 2.01, ale také provádět jejich opravy. Implementace samotná intenzivně využívá mapování média do paměti a tím sdíleného paměťového prostoru (\textit{Shared Memory}) pro zjednodušení práce s ním. Díky tomu byly eliminovány chyby vzniklé přesouváním ukazetele po médiu a je umožněno přímé mapování deskriptorů na médium.\\
Vytvořené řešení bylo otestováno vůči výběrové množině testovacích dat, která zachycují nečastěji se vyskytující verze UDF a jejich nejčastější nastavení. Většina testovacích dat byla vytvořena způsobem popsaným v podkapitole \ref{sec:data} a menší část byla převzata z testovací sady nástroje \textit{blkid}. Konkrétní způsoby tvorby a použití testovacích dat jsou popsány v kapitole \ref{ch:results}. Malá část testovacích dat byla vytvářena experimentálním používáním souborového systému s cílem napdobit životní cyklus média v reálném nasazení. I tento přístup pomohl odhalit řadu potíží, které nebylo možné synteticky odhalit. Na základě těchto dat jsou vytvořeny testy, které jsou automaticky spouštěny po každém nahrání do repozitáře a testují, zda nedošlo k poškození dříve funkčních částí. Pevně věřím, že jsem tímto způsobem otestoval širokou škálu možností a pokryl většinu provozních případů.\\
Výsledky práce byly publikovány v komunitě GNU v podobě začlenění výsledného nástroje \texttt{udffskc} do existujícího balíčku \texttt{udftools}. Tento proces předpokládal splnění nejen poždavků této práce ale i určité kvality kódu a jeho testů. Vzhledem k faktu, že od začátku tato práce směřovala k tomuto cíli, byla v ranné fázi práce navázána komunikace se správcem repozitáře a postup byl konzultován s ním. Začleněním nástroje \texttt{udffsck} je zajištěno, že se nástroj dostane ke svým uživatelům, vzhledem k napojení hlavních distribucí na tento repozitář.\\
Pokud mohu zhodnotit výsledky této práce, považuji je za úspěch. Podařilo se vytvořit fungující nástroj pro kontrolu a opravu médií se souborovým systémem UDF pro GNU/Linux, čímž se stává první takovou implementací s otevřeným zdrojovým kódem.
