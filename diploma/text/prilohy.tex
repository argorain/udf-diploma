\chapter{Výčet operačních systémů podporovaných v souborovém systému UDF}
\label{ch:podpora}
\begin{table}[h]
    \centering
    \begin{tabular}{ | l | l | l | }
        \hline
        Třída OS& Identifikátor OS  & Operační systém  \\ \hline\hline
        0       & Libovolné         & Nedefinváno \\ \hline 
        1       & 0                 & DOS/Windows 3.x\\ \hline 
        2       & 0                 & OS/2\\ \hline 
        3       & 0                 & Macintosh OS 9 a starší\\ \hline 
        3       & 1                 & Macintosh OS X a novější\\ \hline 
        4       & 0                 & obecný UNIX\\ \hline 
        4       & 1                 & UNIX -- IBM AIX\\ \hline 
        4       & 2                 & UNIX -- SUN OS/Solaris\\ \hline 
        4       & 3                 & UNIX -- HP/UX\\ \hline 
        4       & 4                 & UNIX -- Silicon Graphics Irix\\ \hline 
        4       & 5                 & UNIX -- Linux\\ \hline 
        4       & 6                 & UNIX -- MKLinux\\ \hline 
        4       & 7                 & UNIX -- FreeBSD\\ \hline 
        4       & 8                 & UNIX -- NetBSD\\ \hline 
        5       & 0                 & Windows 9x -- obsahuje i Windows 98/ME\\ \hline 
        6       & 0                 & \makecell{Windows NT -- obsahuje Windows 2000, XP, Server 2003\\ a pozdější na stejné bázi}\\ \hline 
        7       & 0                 & OS/400\\ \hline 
        8       & 0                 & BeOS\\ \hline 
        9       & 0                 & Windows CE\\ \hline 
    \end{tabular}
    \caption{Seznam oficiálně podporovaných OS\label{tab:os-types}}
\end{table}

\chapter{Manuálová stránka k \texttt{udffsck}}
\label{ch:manpage}
\begin{Verbatim}[fontsize=\footnotesize]
UDFFSCK(8)               System Manager's Manual               UDFFSCK(8)



NAME
       udffsck - check and correction for UDF filesystem

SYNOPSIS
       udffsck [-vvvciph] [-B BLOCKSIZE] medium

DESCRIPTION
       udffsck  is used to check and correct UDF file systems.  There are
       known limitations regarding UDF version, which is now  limited  to
       2.01 or older.

       medium  is  the  device  file  where  file  system is stored (e.g.
       /dev/sda1).

       Please note it is not safe run udffsck  on  mounted  file  system.
       Even  if  you  think  it is safe to run it on mounted file system,
       whole report is invalid.  You should never never make any  changes
       on  mounted  file  system, so if udffsck asks to do so, only valid
       answer is ,,no'', otherwise you can break your filesystem instead.

OPTIONS
       -B BLOCKSIZE
              Force udffsck to use this blocksize instead  of  autodetec-
              tion.   This  value  is  in bytes.  Default is autodetected
              value by finding VRS and AVDP positions.

       -c     Only check medium and print found errors.  This is  default
              behavior.

       -i     Interactively  fix  medium.   In  this mode all corrections
              must be authorized by user.

       -p     Automatical corrections. This is like -i, but all questions
              are answered yes.

       -h     Short help message.

       -v     Warning  verbosity  level.   Errors  and  warning  will  be
              printed.

       -vv    Message verbosity level.   Errors,  warnings  and  messages
              will be printed.  Recomended for manual usage.

       -vvv   Debug Verbosity level.  Only for development and debug pur-
              poses.  And for nosy users.

EXIT CODE
       The exit code returned by udffsck is the sum of the following con-
       ditions:
              0      - No errors
              1      - File system errors corrected
              2      - File system errors corrected, system should
                       be rebooted (not used at this moment)
              4      - File system errors left uncorrected
              8      - Operational error
              16     - Usage or syntax error
              32     - udffsck canceled by user request
              128    - Shared library error (not used at this moment)

EXAMPLES
       Check medium and show it structure to user:

              udffsck -vvc /dev/sda2

       Check and fix medium image automatically, show only errors:

              udffsck -p udf_image_file.img

BUGS
       Reading  and correcting is supported on UDF filesystems up to ver-
       sion 2.01.  More recent filesystems are not currently covered  and
       udffsck will end with exit code 8.

REPORTING BUGS
       Almost  any  piece  of  software will have bugs.  If you manage to
       find a filesystem which causes udffsck to crash, or which  udffsck
       is unable to  repair,  please report it to the author.

       Please  include as much information as possible in bug report.  It
       helps to analyze bug and hopefuly fix it.

       Necessary information in bug report are udffsck  version  (obtain-
       able  by -h option) and OS information (uname -a).  Also if possi-
       ble attach compressed medium image which  made  udffsck  fail  and
       complete log from stdout and stderr at debug verbosity (obtainable
       by -vvv option).

AUTHOR
       This  version  of  udffsck  was   written   by   Vojtech   Vladyka
       <vojtech.vladyka@gmail.com>

SEE ALSO
       cdrwtool(1), fsck(8), mkudfs(8), pktsetup(8), wrudf(8)



UDFTOOLS 1.3                     May 2017                      UDFFSCK(8)
\end{Verbatim}

\chapter{Ukázkový výpis programu \texttt{udffsck}}
\begin{lstlisting}[frame=single,caption={Ukázka výstupu programu pro médium s veliostí sektoru 512~B},label=lst:bs512,basicstyle=\ttfamily\scriptsize, keywordstyle=\color{black}\bfseries\underbar,nolol,numbers=left]
Device block size: 512
non-option ARGV-elements: ../../udf-samples/bs512-r0150_2.img 
File to analyze: ../../udf-samples/bs512-r0150_2.img
FD: 0x3
[DBG] try #0
[DBG] vsd: type:0, id:BEA01, v:1
[DBG] try #1
[DBG] vsd: type:0, id:NSR02, v:1
[DBG] try #2
[DBG] vsd: type:0, id:TEA01, v:1
bea: type:0, id:BEA01, v:1
nsr: type:0, id:NSR02, v:1
tea: type:0, id:TEA01, v:1
DevSize: 5120000
Current position: 20000
Calc CRC: 0x0878, TagCRC: 0x0878
AVDP[0] successfully loaded.
DevSize: 5120000
Current position: 4e1e00
Calc CRC: 0x0878, TagCRC: 0x0878
AVDP[1] successfully loaded.
DevSize: 5120000
Current position: 4c1e00
Calc CRC: 0x0878, TagCRC: 0x0878
AVDP[2] successfully loaded.

Trying to load VDS
Current position: 20200
Tag ID: 1
VolNum: 1
pVolNum: 0
seqNum: 1
predLoc: 0
New positon is 0x20400
Tag ID: 6
LVD size: 0x1b8
NumOfPartitionMaps: 1
MapTableLength: 6
[0x01] [0x06] [0x01] [0x00] [0x00] [0x00] 
New positon is 0x20600
Tag ID: 5
New positon is 0x20800
Tag ID: 7
VolDescNum: 6
NumAllocDesc: 2
New positon is 0x20a00
Tag ID: 4
New positon is 0x20c00
Tag ID: 8
New positon is 0x20e00
Tag ID: 0
Current position: 4dfe00
Tag ID: 1
VolNum: 1
pVolNum: 0
seqNum: 1
predLoc: 0
New positon is 0x4e0000
Tag ID: 6
LVD size: 0x1b8
NumOfPartitionMaps: 1
MapTableLength: 6
[0x01] [0x06] [0x01] [0x00] [0x00] [0x00] 
New positon is 0x4e0200
Tag ID: 5
New positon is 0x4e0400
Tag ID: 7
VolDescNum: 6
NumAllocDesc: 2
New positon is 0x4e0600
Tag ID: 4
New positon is 0x4e0800
Tag ID: 8
New positon is 0x4e0a00
Tag ID: 0
LVID: loc: 273, len: 512
LVID: lenOfImpUse: 46
LVID: freeSpaceTable: 4613
LVID: sizeTable: 4613
Calc CRC: 0x3501, TagCRC: 0x3501
Calc CRC: 0x5f00, TagCRC: 0x5f00
Calc CRC: 0xaa1b, TagCRC: 0xaa1b
Calc CRC: 0xe0ee, TagCRC: 0xe0ee
Calc CRC: 0x2a01, TagCRC: 0x2a01
Calc CRC: 0x0000, TagCRC: 0x0000
Calc CRC: 0x3501, TagCRC: 0x3501
Calc CRC: 0x5f00, TagCRC: 0x5f00
Calc CRC: 0xaa1b, TagCRC: 0xaa1b
Calc CRC: 0xe0ee, TagCRC: 0xe0ee
Calc CRC: 0x2a01, TagCRC: 0x2a01
Calc CRC: 0x0000, TagCRC: 0x0000
UDF Metadata Overview
=====================
UDF revision: 0
Disc blocksize: 0
Disc blocksize bits: 0
Flags: 0

AVDP
----
[0]
	Identification Tag
	==================
	ID: 2 (AVDP)
	Version: 2
	Checksum: 0x77
	Serial Number: 0x1
	Descriptor CRC: 0x878, Length: 496
	Tag Location: 0x100
[1]
	Identification Tag
	==================
	ID: 2 (AVDP)
	Version: 2
	Checksum: 0xac
	Serial Number: 0x1
	Descriptor CRC: 0x878, Length: 496
	Tag Location: 0x270f
[2]
	Identification Tag
	==================
	ID: 2 (AVDP)
	Version: 2
	Checksum: 0xab
	Serial Number: 0x1
	Descriptor CRC: 0x878, Length: 496
	Tag Location: 0x260f
PVD
---
[0]
	Identification Tag
	==================
	ID: 1 (PVD)
	Version: 2
	Checksum: 0x2d
	Serial Number: 0x1
	Descriptor CRC: 0x3501, Length: 496
	Tag Location: 0x101
[1]
	Identification Tag
	==================
	ID: 1 (PVD)
	Version: 2
	Checksum: 0x50
	Serial Number: 0x1
	Descriptor CRC: 0x3501, Length: 496
	Tag Location: 0x26ff
LVD
---
[0]
	Identification Tag
	==================
	ID: 6 (LVD)
	Version: 2
	Checksum: 0x1a
	Serial Number: 0x1
	Descriptor CRC: 0x5f00, Length: 430
	Tag Location: 0x102
Partition Maps: 1
[1]
	Identification Tag
	==================
	ID: 6 (LVD)
	Version: 2
	Checksum: 0x3e
	Serial Number: 0x1
	Descriptor CRC: 0x5f00, Length: 430
	Tag Location: 0x2700
Partition Maps: 1
PD
--
[0]
	Identification Tag
	==================
	ID: 5 (PD)
	Version: 2
	Checksum: 0xc2
	Serial Number: 0x1
	Descriptor CRC: 0xaa1b, Length: 496
	Tag Location: 0x103
[1]
	Identification Tag
	==================
	ID: 5 (PD)
	Version: 2
	Checksum: 0xe6
	Serial Number: 0x1
	Descriptor CRC: 0xaa1b, Length: 496
	Tag Location: 0x2701
USD
---
[0]
	Identification Tag
	==================
	ID: 7 (USD)
	Version: 2
	Checksum: 0xf5
	Serial Number: 0x1
	Descriptor CRC: 0xe0ee, Length: 24
	Tag Location: 0x104
[1]
	Identification Tag
	==================
	ID: 7 (USD)
	Version: 2
	Checksum: 0x19
	Serial Number: 0x1
	Descriptor CRC: 0xe0ee, Length: 24
	Tag Location: 0x2702
IUVD
----
[0]
	Identification Tag
	==================
	ID: 4 (IUVD)
	Version: 2
	Checksum: 0x29
	Serial Number: 0x1
	Descriptor CRC: 0x2a01, Length: 496
	Tag Location: 0x105
[1]
	Identification Tag
	==================
	ID: 4 (IUVD)
	Version: 2
	Checksum: 0x4d
	Serial Number: 0x1
	Descriptor CRC: 0x2a01, Length: 496
	Tag Location: 0x2703
TD
--
[0]
	Identification Tag
	==================
	ID: 8 (TD)
	Version: 2
	Checksum: 0x3
	Serial Number: 0x1
	Descriptor CRC: 0x0, Length: 496
	Tag Location: 0x106
[1]
	Identification Tag
	==================
	ID: 8 (TD)
	Version: 2
	Checksum: 0x27
	Serial Number: 0x1
	Descriptor CRC: 0x0, Length: 496
	Tag Location: 0x2704
LAP: length: 200, LBN: 3, PRN: 0
LAP: LSN: 274
LogicVolIdent: udf512
FileSetIdent: LinuxUDF
LBNLSN: 274
ROOT LSN: 278
Calc CRC: 0xa05f, TagCRC: 0xa05f

FE, LSN: 278, EntityID: *Linux UDFFS fileLinkCount: 3, LB recorded: 0
LEA 0, LAD 236
01 01 02 00 9c 00 01 00 
dd 9e 18 00 04 00 00 00 
01 00 0a 00 00 02 00 00 
04 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 
01 01 02 00 e8 00 01 00 
df e0 20 00 04 00 00 00 
01 00 00 0a 00 02 00 00 
05 00 00 00 00 00 00 00 
10 00 00 00 00 00 08 69 
6d 61 67 65 2e 69 73 6f 
01 01 02 00 e5 00 01 00 
86 36 20 00 04 00 00 00 
01 00 00 08 00 02 00 00 
3a 12 00 00 00 00 00 00 
11 00 00 00 00 00 08 68 
69 73 74 6f 72 79 00 00 
01 01 02 00 21 00 01 00 
06 f2 20 00 04 00 00 00 
01 00 02 07 00 02 00 00 
f4 12 00 00 00 00 00 00 
12 00 00 00 00 00 08 53 
6c 6f 7a 6b 61 00 00 00 
01 01 02 00 0a 00 01 00 
6a 73 24 00 04 00 00 00 
01 00 02 0e 00 02 00 00 
f6 12 00 00 00 00 00 00 
14 00 00 00 00 00 08 50 
72 61 7a 64 6e 61 53 6c 
6f 7a 6b 61 00 00 00 00 

FID found.
Calc CRC: 0x9edd, TagCRC: 0x9edd
FID: ImpUseLen: 0
FID: FilenameLen: 0
ROOT directory
ICB: LSN: 278, length: 512
ROOT ICB: LSN: 278
Actual LSN: 278
Parent. Not Following this one
FLen: 38, padding: 2

FID found.
Calc CRC: 0xe0df, TagCRC: 0xe0df
FID: ImpUseLen: 0
FID: FilenameLen: 10
Filename: image.iso
ICB: LSN: 279, length: 512
ROOT ICB: LSN: 278
Actual LSN: 278
ICB to follow.
Calc CRC: 0x0125, TagCRC: 0x0125

FE, LSN: 279, EntityID: *Linux UDFFS fileLinkCount: 1, LB recorded: 4660
LEA 0, LAD 16
LONG
ExtLen: 4660, ExtLoc: 280
LSN: 4939
00 68 24 00 06 00 00 00 
00 00 00 00 00 00 00 00 

Return from ICB
FLen: 48, padding: 0

FID found.
Calc CRC: 0x3686, TagCRC: 0x3686
FID: ImpUseLen: 0
FID: FilenameLen: 8
Filename: history
ICB: LSN: 4940, length: 512
ROOT ICB: LSN: 278
Actual LSN: 278
ICB to follow.
Calc CRC: 0xd45e, TagCRC: 0xd45e

FE, LSN: 4940, EntityID: *Linux UDFFS fileLinkCount: 1, LB recorded: 185
LEA 0, LAD 16
LONG
ExtLen: 184, ExtLoc: 4941
LSN: 5124
5b 71 01 00 3b 12 00 00 
00 00 00 00 00 00 00 00 

Return from ICB
FLen: 46, padding: 2

FID found.
Calc CRC: 0xf206, TagCRC: 0xf206
FID: ImpUseLen: 0
FID: FilenameLen: 7
Filename: Slozka
ICB: LSN: 5126, length: 512
ROOT ICB: LSN: 278
Actual LSN: 278
ICB to follow.
Calc CRC: 0x84d4, TagCRC: 0x84d4

FE, LSN: 5126, EntityID: *Linux UDFFS fileLinkCount: 2, LB recorded: 0
LEA 0, LAD 148
01 01 02 00 9e 00 01 00 
dd 9e 18 00 f4 12 00 00 
01 00 0a 00 00 02 00 00 
04 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 
01 01 02 00 a6 00 01 00 
f7 80 24 00 f4 12 00 00 
01 00 00 0b 00 02 00 00 
f5 12 00 00 00 00 00 00 
13 00 00 00 00 00 08 73 
6f 75 62 6f 72 2e 74 78 
74 00 00 00 01 01 02 00 
fd 00 01 00 48 82 28 00 
f4 12 00 00 01 00 02 11 
00 02 00 00 f7 12 00 00 
00 00 00 00 15 00 00 00 
00 00 08 50 72 61 7a 64 
6e 61 50 6f 64 6c 6f 73 
7a 6b 61 00 00 00 00 00 

FID found.
Calc CRC: 0x9edd, TagCRC: 0x9edd
FID: ImpUseLen: 0
FID: FilenameLen: 0
ROOT directory
ICB: LSN: 278, length: 512
ROOT ICB: LSN: 278
Actual LSN: 5126
Parent. Not Following this one
FLen: 38, padding: 2

FID found.
Calc CRC: 0x80f7, TagCRC: 0x80f7
FID: ImpUseLen: 0
FID: FilenameLen: 11
Filename: soubor.txt
ICB: LSN: 5127, length: 512
ROOT ICB: LSN: 278
Actual LSN: 5126
ICB to follow.
Calc CRC: 0x5e2e, TagCRC: 0x5e2e

FE, LSN: 5127, EntityID: *Linux UDFFS fileLinkCount: 1, LB recorded: 0
LEA 0, LAD 0

Return from ICB
FLen: 49, padding: 3

FID found.
Calc CRC: 0x8248, TagCRC: 0x8248
FID: ImpUseLen: 0
FID: FilenameLen: 17
Filename: PrazdnaPodloszka
ICB: LSN: 5129, length: 512
ROOT ICB: LSN: 278
Actual LSN: 5126
ICB to follow.
Calc CRC: 0x4690, TagCRC: 0x4690

FE, LSN: 5129, EntityID: *Linux UDFFS fileLinkCount: 1, LB recorded: 0
LEA 0, LAD 40
01 01 02 00 cf 00 01 00 
db ce 18 00 f7 12 00 00 
01 00 0a 00 00 02 00 00 
f4 12 00 00 00 00 00 00 
12 00 00 00 00 00 00 00 

FID found.
Calc CRC: 0xcedb, TagCRC: 0xcedb
FID: ImpUseLen: 0
FID: FilenameLen: 0
ROOT directory
ICB: LSN: 5126, length: 512
ROOT ICB: LSN: 278
Actual LSN: 5129
Parent. Not Following this one
FLen: 38, padding: 2

Return from ICB
FLen: 55, padding: 1

Return from ICB
FLen: 45, padding: 3

FID found.
Calc CRC: 0x736a, TagCRC: 0x736a
FID: ImpUseLen: 0
FID: FilenameLen: 14
Filename: PrazdnaSlozka
ICB: LSN: 5128, length: 512
ROOT ICB: LSN: 278
Actual LSN: 278
ICB to follow.
Calc CRC: 0x1a4e, TagCRC: 0x1a4e

FE, LSN: 5128, EntityID: *Linux UDFFS fileLinkCount: 1, LB recorded: 0
LEA 0, LAD 40
01 01 02 00 a0 00 01 00 
dd 9e 18 00 f6 12 00 00 
01 00 0a 00 00 02 00 00 
04 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 

FID found.
Calc CRC: 0x9edd, TagCRC: 0x9edd
FID: ImpUseLen: 0
FID: FilenameLen: 0
ROOT directory
ICB: LSN: 278, length: 512
ROOT ICB: LSN: 278
Actual LSN: 5128
Parent. Not Following this one
FLen: 38, padding: 2

Return from ICB
FLen: 52, padding: 0

All done
\end{lstlisting}
\textbf{Legenda} (čísla řádků)
\begin{enumerate}
    \item Zobrazení přijatého parametru velikost sektoru
    \item Ladicí výpis parseru vstupních argumentů
    \item Soubor k analýze
    \item Ladicí informace - File Descriptor v operačním systému
    \item - 10. Ladicí informace ze čtení VRS \addtocounter{enumi}{5}
    \item - 13. Nalezená VRS sekvence \addtocounter{enumi}{2}
    \item - 26. Načtení a kontrola třech AVDP \addtocounter{enumi}{12}
    \item - 75. Načtení hlavní a rezervní VDS a výpis ladicích údajů u některých deskriptorů \addtocounter{enumi}{48}
    \item - 79. Načtení LVID \addtocounter{enumi}{3}
    \item - 91. Ladicí výpis výpočtů a očekávaných hodnot CRC pro VDS \addtocounter{enumi}{11}
    \item - 249. Výpis všech tagů VDS \addtocounter{enumi}{157}
    \item - 257. Načtení a kontrola FSD \addtocounter{enumi}{7}
    \item - 290. Načtení FE, v tomto případě se jedná o kořenový adresář. Výpis bytového pole je položka \texttt{AllocationDescriptors} a ta obsahuje FID jeho potomků. \addtocounter{enumi}{32}
    \item - 301. Výpis FID. Povšimněte si řádku 299, kde je zobrazen ladicí výpis \textit{Parent. Not followng this one.}. Proto je tento FID přeskočen a pokračuje se k dalšímu. Případ s následováním začíná na řádku 302. \addtocounter{enumi}{10}
    \item - 312. Načtení FID. Zde již na řádku 310 je vidět hláška \textit{ICB to follow}, což znamená, že se zanoříme na adresu určenou tímto deskriptorem. \addtocounter{enumi}{10}
    \item - 320. Výpis FE na který ukazoval předchozí FID. Jedná se o soubor, proto jeho \texttt{AllocationDescriptors} obsahují pouze \texttt{long address} dat a ne FID. \addtocounter{enumi}{7}
    \item Ladicí výpis informujicí o úspěšném návratu zpět do rodičovské FE.
    \item Ladicí výpis zobrazující jak dlouhý FID je a o kolik se tím pádem má posunout pro další.
\end{enumerate}
Takto program postupně zpracuje všechny soubory až skončí s hláškou \textit{All done}. Pokud vše skončilo správně, měl by vrátit 0.

\chapter{Výstupy z referenčního řešení \texttt{udfct}}
\begin{lstlisting}[frame=single,caption={Výsledek kontroly poškozeného média referenčním programem \texttt{udfct}},label=lst:udfct-broken,basicstyle=\ttfamily\scriptsize, keywordstyle=\color{black}\bfseries\underbar,nolol,numbers=left,texcl=false,escapechar=!]
UDF Conformance Testing Application
(c) Koninklijke Philips Electronics N.V. 1999-2006
Application version : 1.5r4 distribution bin
   UCT Core version : 1.5r4 distribution bin
       platform : Linux - with scsi support

Command:
  ./udf_test
Generic options parsing:

Medium info options parsing:
    -blocksize 512

Device options parsing:
    ../../../udffsck-test-samples/udf-samples/bs512_windows7_udf0201_broken_file_tree.img

No image configuration file ../../../udffsck-test-samples/udf-samples/bs512_windows7_udf0201_broken_file_tree.cfg


Created image device
  image file blocks : 3913728  ../../../udffsck-test-samples/udf-samples/bs512_windows7_udf0201_broken_file_tree.img
     blocks, bytes  : 3913728  2003828736


'-image' device Medium Info:
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 0
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : unknown
  medium SE type    : unknown
  medium CL type    : unknown finalization state

=> Warning: Undefined (ECC) blocking factor, set to 16.
-       Please specify "-ecclength <n>" to enable the verifier to do
-       a better job. Media that do not have ECC or fixed size packets
-       must specify: -ecclength 1

Inspect 1 block for presence of VAT or AVDP
starting at block: 3913727

  ==>   read cache: max 32 buffers of 32 sectors, total 512 Kb
3913727         1 ok block read
3913727 AVDP    (MVDS: 96, RVDS: 3913696)

last AVDP at 3913727 (N)

    Single Layer medium

Verification start medium info
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 16
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : unknown
  medium SE type    : unknown
  medium CL type    : unknown finalization state

====>   Start verification
    Start time   : 2017-05-09 10:41:32 +02:00 (east of UTC)
    Verbose level: 100
    Message limit: 20
    Fake read enabled
    Read cache enabled
    Initial UDF Revision range: 1.02 thru 2.60
    Single Layer medium

====>   Volume Structure verification
    Read Volume Recognition Sequence
     64 read 4 blocks
    BEA01
    Start of Extended Area
     68 read 4 blocks
    NSR03
  ==>   Changed UDF Revision range from: 1.02 thru 2.60 to: 2.00 thru 2.60
-   because of "NSR03 descriptor"
     72 read 4 blocks
    TEA01
     76 read 4 blocks
    End of Extended Area
    End of Volume Recognition Sequence


    Reading Volume Information
    256 read block
    AVDP at 256 (MVDS: 96, RVDS: 3913696)
    First Tag Serial Number: 2
3913471 read block
    AVDP at N-256   (MVDS: 96, RVDS: 3913696)
3913727 read block
    AVDP at N   (MVDS: 96, RVDS: 3913696)

    Number of AVDPs: 3, AVDPs at  256,  N-256,  N

====>   Read Main VDS extent:      96, length:   8192
     96 read block
    PVD   VDS Number: 1
    PVD   Recording Time: 2017-05-05 17:58:30.010400 +02:00
    PVD   Volume Identifier    : "UDF Volume"
    PVD   Volume Set Identifier: "113A1E01 UDF Volume Set"
  ==>   PVD  344 New Entity Identifier (regid):
    Application Entity Identifier
      <empty>
  ==>   PVD  388 New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Microsoft Windows"
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
  ==>   Add PVD to VDS info
     97 read block
    PD    VDS Number: 2, Partition Number: 8192
  ==>   PD   24  New Entity Identifier (regid):
    Application Entity Identifier
      Identifier         : "+NSR03"
    Unallocated Space Bitmap
  ==>   Add PD to VDS info, partition number: 8192
     98 read block
    LVD   VDS Number: 3
    LVD   Logical Volume Identifier: "windows7_udf_r2.01"
  ==>   LVD  216 New Entity Identifier (regid):
    Domain Entity Identifier
      Identifier         : "*OSTA UDF Compliant"
      UDF revision       : 2.01
  ==>   Changed UDF Revision range from: 2.00 thru 2.60 to: 2.01 only
-   because of "Domain EntityID UDF revision"
      Domain flags       : #00
    LVD   FSD at: (0,p0)
  ==>   Add LVD to VDS info
     99 read block
    USD   VDS Number: 4, nmb of ADs: 7
     1: location      76 thru        95,       20 blocks
     2: location     112 thru       127,       16 blocks
     3: location     144 thru       255,      112 blocks
     4: location     257 thru       287,       31 blocks
     5: location 3913440 thru   3913470,       31 blocks
     6: location 3913472 thru   3913695,      224 blocks
     7: location 3913712 thru   3913726,       15 blocks
  ==>   Add USD to VDS info
    100 read block
    IUVD  VDS Number: 5
    IUVD EntityID Identifier: "*UDF LV Info"
  ==>   IUVD 20  New Entity Identifier (regid):
    UDF Entity Identifier
      Identifier         : "*UDF LV Info"
      UDF revision       : 2.01
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    UDF IUVD Logical Volume Identifier : "windows7_udf_r2.01"
    UDF IUVD LVInfo1: <undefined>
    UDF IUVD LVInfo2: <undefined>
    UDF IUVD LVInfo3: <undefined>
  ==>   Add IUVD to VDS info
    101 read block
    TD  

====>   Read Reserve VDS extent: 3913696, length:   8192
3913696 read block
    PVD   VDS Number: 1
    PVD   Recording Time: 2017-05-05 17:58:30.010400 +02:00
    PVD   Volume Identifier    : "UDF Volume"
    PVD   Volume Set Identifier: "113A1E01 UDF Volume Set"
  ==>   Add PVD to VDS info
3913697 read block
    PD    VDS Number: 2, Partition Number: 8192
    Unallocated Space Bitmap
  ==>   Add PD to VDS info, partition number: 8192
3913698 read block
    LVD   VDS Number: 3
    LVD   Logical Volume Identifier: "windows7_udf_r2.01"
    LVD   FSD at: (0,p0)
  ==>   Add LVD to VDS info
3913699 read block
    USD   VDS Number: 4, nmb of ADs: 7
     1: location      76 thru        95,       20 blocks
     2: location     112 thru       127,       16 blocks
     3: location     144 thru       255,      112 blocks
     4: location     257 thru       287,       31 blocks
     5: location 3913440 thru   3913470,       31 blocks
     6: location 3913472 thru   3913695,      224 blocks
     7: location 3913712 thru   3913726,       15 blocks
  ==>   Add USD to VDS info
3913700 read block
    IUVD  VDS Number: 5
    IUVD EntityID Identifier: "*UDF LV Info"
    UDF IUVD Logical Volume Identifier : "windows7_udf_r2.01"
    UDF IUVD LVInfo1: <undefined>
    UDF IUVD LVInfo2: <undefined>
    UDF IUVD LVInfo3: <undefined>
  ==>   Add IUVD to VDS info
3913701 read block
    TD  

====>   Check equivalence of Main VDS and Reserve VDS

  ==>   Main and Reserve VDS are equivalent

====>   Check Main VDS. Summary:
     PVD VDS Number  1
     LVD VDS Number  3
     USD VDS Number  4
      PD VDS Number  2
    IUVD VDS Number  5  ID: "*UDF LV Info"
       5 prevailing VDS descriptors found


  ==>   Using Main VDS

  ==>   Checking VDS 'far apart' allocation for Main and Reserve VDS.

   =>   Volume Descriptor Sequence 'far apart' test summary:
-         Main VDS LBA range:         96  thru        111,   1 extent
-      Reserve VDS LBA range:    3913696  thru    3913711,   1 extent
-     lowest packet distance:  244600 ECC packets (100.0% of remaining Volume Space)
-        test margin level 1:   24500 ECC packets ( 10.0% of remaining Volume Space)
-        test margin level 2:   61200 ECC packets ( 25.0% of remaining Volume Space)
-          Main VDS    Reserve VDS    ECC packet distance
-              111        3913696       244600                      


====>   Checking Logical Volume: "windows7_udf_r2.01"

    Prevailing Partition Descriptors:
      pNmb: 8192, start:   288, length: 3913152, access: overwritable

    LVD Partition Maps:
      p0: Physical Partition Map (Type 1), pNmb: 8192

  ==>   Changed medium WR type from unknown to overwritable
-           because of partition access type
  ==>   Changed medium SE type from unknown to nonsequential
-           because of no Virtual Partition found


    Mounted Partitions:
-   p0: Physical, pNmb: 8192, blocks:     288 thru 3913439, access: overwritable
-             logical blocks:       0 thru 3913151

  ==>   Changed medium CL type from unknown finalization state to finalized
-           because of more than one AVDP found

    Read LVID sequence extent: 128, length: 8192
    128 read block
    LVID  - Open
    !\colorbox{yellow}{LVID 8   Error: Descriptor CRC: \#24B2, expected: \#03CC, ECMA 3/7.2.6, 4/7.2.6}!
    LVID Recording Time: 2017-05-05 16:15:01.278032
  ==>   LVID 88  New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Microsoft Windows     "
      OS Class           : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
      Implementation Use : #00 #00 #06 #01 #01 #00
    129 read block
    TD  
    !\colorbox{yellow}{LVID 28  Error: Dirty Volume. An Open prevailing LVID was}!
-        !\colorbox{yellow}{found but no Virtual Partition. The Logical Volume}!
-        !\colorbox{yellow}{is in an inconsistent state, unexpected errors}!
-        !\colorbox{yellow}{may occur, ECMA 3/8.8.2, 3/10.10.3.}!
-   Note: The verifier will assume the volume to have a Close LVID
-         in order to show all LVID and volume inconsistencies.

    Next UniqueID: #0000000000000012,
    from LVID Logical Volume Header Descriptor.


  ==>   p0: read Unallocated or Freed Partition Space Sets
        Unallocated Space Bitmap extent: 956 blocks
    320 read block
    321 read 955 blocks
    SBD 
    SBD  10     Note: Descriptor CRC Length: 8. This is the recommended value
-             according to errata DCN-5108 for UDF 2.50 and lower.
    p0: Space set found
    --

    Read FSD sequence extent: (0,p0), length:    512

    288 read block
    FSD   FSN: 0,  FSDN: 0
    FSD   Logical Volume Identifier: "windows7_udf_r2.01"
    FSD         File Set Identifier: "UDF Volume Set"
    FSD   Copyright File Identifier: <undefined>
    FSD    Abstract File Identifier: <undefined>
    FSD           Root Directory at: (988,p0)
    FSD  System Stream Directory at: <undefined>

====>   Volume identifiers summary:

        PVD:         Volume Identifier  [32]: "UDF Volume"
        PVD:     Volume Set Identifier [128]: "113A1E01 UDF Volume Set"
        LVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
       IUVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD:       File Set Identifier  [32]: "UDF Volume Set"

====>   File Structure verification

    Read Root Directory
   1276 read block
    EFE  file type DIR    name: <root>
    !\colorbox{yellow}{EFE  80  Error: FE Access Time shall not be later than}!
-        !\colorbox{yellow}{LVID Recording Time, ECMA 3/10.10.2, UDF 2.2.6, UDF 3.1.1.}!
-             !\colorbox{yellow}{FE Access Time: 2017-05-05 16:15:01.282032}!
-        !\colorbox{yellow}{LVID Recording Time: 2017-05-05 16:15:01.278032}!
-        name: <root>
  ==>   EFE  168 New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Linux UDFFS"
      OS Class       : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
    EFE  216 Embedded data, 152 bytes

  ==>   (max) depth:  1  1  Expand directory: <root>

    EFE  216 Verify embedded FIDs, 152 bytes
    FID   cid:       name: /<parent FID>, refers to: <root>
    FID   cid:   8   name: "gtd.mp4"
    FID   cid:   8   name: "2017-01-16-191632.webm"
    !\colorbox{yellow}{Error: Tag Serial Number changing: 2 -> 1, no disaster}!
-          !\colorbox{yellow}{recovery support, ECMA 3/7.2.5, 4/7.2.5, UDF 2.3.1.1.}!
-        name: "2017-01-16-191632.webm"
    Add FIDs to directory hierarchy and read FEs
    289 read block
    EFE  file type FILE   name: "gtd.mp4"
    !\colorbox{yellow}{Error: Tag Serial Number changing: 1 -> 2, no disaster}!
-          !\colorbox{yellow}{recovery support, ECMA 3/7.2.5, 4/7.2.5, UDF 2.3.1.1.}!
-        name: "gtd.mp4"
- ==>   Message printed 2 times, ignored from now.
    !\colorbox{yellow}{EFE  80  Error: FE Access Time shall not be later than}!
-        !\colorbox{yellow}{LVID Recording Time, ECMA 3/10.10.2, UDF 2.2.6, UDF 3.1.1.}!
-             !\colorbox{yellow}{FE Access Time: 2017-05-05 16:15:06.790101}!
-        !\colorbox{yellow}{LVID Recording Time: 2017-05-05 16:15:01.278032}!
-        name: "gtd.mp4"
    cnt:  extent type,      size,  location,part,     body, total alloc
      1: short_ad   0  327345425      39131 0    327345425  327345664
   1277 read block
    EFE  file type FILE   name: "2017-01-16-191632.webm"
    !\colorbox{yellow}{EFE  80  Error: FE Access Time shall not be later than}!
-        !\colorbox{yellow}{LVID Recording Time, ECMA 3/10.10.2, UDF 2.2.6, UDF 3.1.1.}!
-             !\colorbox{yellow}{FE Access Time: 2017-05-05 16:15:31.094407}!
-        !\colorbox{yellow}{LVID Recording Time: 2017-05-05 16:15:01.278032}!
-        name: "2017-01-16-191632.webm"
    !\colorbox{yellow}{EFE  92  Error: FE Modification Time shall not be later than}!
-        !\colorbox{yellow}{LVID Recording Time, ECMA 3/10.10.2, UDF 2.2.6, UDF 3.1.1.}!
-        !\colorbox{yellow}{FE Modification Time: 2017-05-05 16:15:31.330410}!
-         !\colorbox{yellow}{LVID Recording Time: 2017-05-05 16:15:01.278032}!
-        name: "2017-01-16-191632.webm"
    !\colorbox{yellow}{EFE  116 Error: FE Attribute Time shall not be later than}!
-        !\colorbox{yellow}{LVID Recording Time, ECMA 3/10.10.2, UDF 2.2.6, UDF 3.1.1.}!
-          !\colorbox{yellow}{FE Attribute Time: 2017-05-05 16:15:31.330410}!
-        !\colorbox{yellow}{LVID Recording Time: 2017-05-05 16:15:01.278032}!
-        name: "2017-01-16-191632.webm"
    !\colorbox{yellow}{EFE  104 Error: EFE Creation Time shall not be later than}!
-        !\colorbox{yellow}{LVID Recording Time, ECMA 3/10.10.2, UDF 2.2.6, UDF 3.1.1.}!
-          !\colorbox{yellow}{EFE Creation Time: 2017-05-05 16:15:31.094407}!
-        !\colorbox{yellow}{LVID Recording Time: 2017-05-05 16:15:01.278032}!
-        name: "2017-01-16-191632.webm"
    cnt:  extent type,      size,  location,part,     body, total alloc
      1: long_ad    0    9830400        990 0      9830400    9830400
      2: long_ad    1       1024      20190 0      9830400    9831424
    !\colorbox{yellow}{EFE  72  Error: Logical Blocks Recorded: 19202, expected: 19200,}!
-           !\colorbox{yellow}{icbtag Allocation Descriptor type: 1,}!
-           !\colorbox{yellow}{UDF 2.3.6.5, ECMA 4/14.9.11, 4/14.6.8.}!
-        name: "2017-01-16-191632.webm"

Directory: <root>

.d.p.e..........:..rwx:..rwx:..rwx DIR   1 2017-05-05 15:58        152 /<parent FID>, refers to: <root>
.....S..........:..rwx:..rwx:..rwx FILE  1 2009-11-12 19:46  327345425 "gtd.mp4"
.....L..........:..rw.:..r..:..r.. FILE  1 2017-05-05 16:15    9830400 "2017-01-16-191632.webm"

    file body read: "gtd.mp4"
  39419 fake read 639347 blocks
    file body read: "2017-01-16-191632.webm"
   1278 fake read 19200 blocks
    file tail read: "2017-01-16-191632.webm"
  20478 fake read 2 blocks

    Expand complete, max depth  1 for directory: <root>
-              2 files   0 directories
-    overall total:    2 files   1 directory  

    Maximum directory depth: 1

    End of directory tree expansion
    Excluding deleted FIDs with cleared ICB

====>   Testing File Link Count by cross reference of 4 paths.
    File Link Count errors will be identified here by the
    physical address of the File Entry as well as all
    paths identifying the File Entry.
    The physical address of the File Entry is also shown in
    the informational read block messages above.
    Note that errors found here may have been reported before
    or may be caused by other previously reported errors.

====>   Testing free Volume Space in USD Allocation Descriptors

====>   Build Partition Space Bitmaps.
    Also check structures that overlap with partition space.

====>   Partition Allocation summary :

 ===>   Physical Partition p0:  size 3913152 blocks, overwritable
                blocks     288 thru 3913439

  ==>   Compare partition p0 calculated bitmap to recorded Space Set
      using: Unallocated Space Bitmap

      All used blocks marked as allocated

      !\colorbox{yellow}{Warning: 222981 unused blocks NOT marked as unallocated.}!
-          This may be due to previous errors,
-          or otherwise it is Orphan Space, UDF 5.2.2.
-     Usage of following extents not yet identified:
  20480   logical block    20192 thru    39130,   18939 blocks
 678766   logical block   678478 thru   882519,  204042 blocks

====>   Final LVID verification
    Dirty LVID, verify as Close
  ==>   overwritable Physical Partition p0 Space summary:
                      Partition Length    : 3913152
                 LVID Partition Size      : 3913152
                 LVID Partition Free Space: 3253643
       Unallocated Space Bitmap free space: 3030662
              Verifier expected free space: 3253643
        Unused by UDF but allocated blocks:  222981

    !\colorbox{yellow}{LVID 80  Error: LVID and Unallocated Space Bitmap inconsistent}!
-           !\colorbox{yellow}{Partition Free Space for a Dirty LVID,}!
-           !\colorbox{yellow}{see Space summary above and maybe use}!
-           !\colorbox{yellow}{-showalloc output, ECMA 3/10.1, UDF 2.2.6.2.}!

  ==>          LVID status summary:
    Last modification Time    : 2017-05-05 16:15:01.278032 (equal to UTC)
    Last written Developer Id : "*Microsoft Windows     "
    Next UniqueID             : #0000000000000012 => from dirty LVID
    max used FE  UniqueID     : #0000000000000011
    max used FID UniqueID     :         #00000011
    Number of Files           :        2
    Number of Directories     :        1
    Min UDF Read   Revision   : UDF 2.01
    Min UDF Write  Revision   : UDF 2.01
    Max UDF Write  Revision   : UDF 2.01
        Medium UDF Revision   : UDF 2.01


====>   Testing uniqueness of relevant UniqueIDs.


    Test complete
    Elapsed time : 00:00

====>   Volume identifiers summary:

        PVD:         Volume Identifier  [32]: "UDF Volume"
        PVD:     Volume Set Identifier [128]: "113A1E01 UDF Volume Set"
        LVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
       IUVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD:       File Set Identifier  [32]: "UDF Volume Set"

====>   Encountered EntityID (regid) summary:

 count  EntityID

    3   Domain Entity Identifier
      Identifier         : "*OSTA UDF Compliant"
      UDF revision       : 2.01
      Domain flags       : #00
    2   UDF Entity Identifier
      Identifier         : "*UDF LV Info"
      UDF revision       : 2.01
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    3   Implementation Entity Identifier
      Identifier         : "*Linux UDFFS"
      OS Class       : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
    8   Implementation Entity Identifier
      Identifier         : "*Microsoft Windows"
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    1   Implementation Entity Identifier
      Identifier         : "*Microsoft Windows     "
      OS Class       : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
      Implementation Use : #00 #00 #06 #01 #01 #00
    2   Application Entity Identifier
      <empty>
    2   Application Entity Identifier
      Identifier         : "+NSR03"

  These EntityIDs are also shown above when read for the first time

====>   Final verify status report

  Final UDF Revision range: 2.01 only
  Disaster Recovery for Tag Serial Numbers not supported

  File System info
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 16
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : overwritable
  medium SE type    : nonsequential
  medium CL type    : finalized

  Summed file body sizes: 337175825 bytes   (321.5559 Mbytes)

    Error count:   6    total occurrences:    12  -> search for   "error:"
  Warning count:   2    total occurrences:     2  -> search for "warning:"

  Additional notes may have been printed:     -> search for    "note:"

  Disclaimer:
-   The number of errors and warnings is an indication only.
-   There is no guarantee that the number of errors and
-   warnings as shown by the UDF verifier is correct.
\end{lstlisting}
\pagebreak
\begin{lstlisting}[frame=single,caption={Výsledek kontroly poškozeného média referenčním programem \texttt{udfct} po opravě nástrojem \texttt{CHKDSK}},label=lst:udfct-chkdsk,basicstyle=\ttfamily\scriptsize, keywordstyle=\color{black}\bfseries\underbar,nolol,numbers=left,texcl=false,escapechar=!]
UDF Conformance Testing Application
(c) Koninklijke Philips Electronics N.V. 1999-2006
Application version : 1.5r4 distribution bin
   UCT Core version : 1.5r4 distribution bin
       platform : Linux - with scsi support

Command:
  ./udf_test
Generic options parsing:

Medium info options parsing:
    -blocksize 512

Device options parsing:
    ../../../bs512_windows7_udf0201_chkdsk.img

No image configuration file ../../../bs512_windows7_udf0201_chkdsk.cfg


Created image device
  image file blocks : 3913728  ../../../bs512_windows7_udf0201_chkdsk.img
     blocks, bytes  : 3913728  2003828736


'-image' device Medium Info:
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 0
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : unknown
  medium SE type    : unknown
  medium CL type    : unknown finalization state

=> Warning: Undefined (ECC) blocking factor, set to 16.
-       Please specify "-ecclength <n>" to enable the verifier to do
-       a better job. Media that do not have ECC or fixed size packets
-       must specify: -ecclength 1

Inspect 1 block for presence of VAT or AVDP
starting at block: 3913727

  ==>   read cache: max 32 buffers of 32 sectors, total 512 Kb
3913727         1 ok block read
3913727 AVDP    (MVDS: 96, RVDS: 3913721)

last AVDP at 3913727 (N)

    Single Layer medium

Verification start medium info
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 16
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : unknown
  medium SE type    : unknown
  medium CL type    : unknown finalization state

====>   Start verification
    Start time   : 2017-05-09 09:52:52 +02:00 (east of UTC)
    Verbose level: 100
    Message limit: 20
    Fake read enabled
    Read cache enabled
    Initial UDF Revision range: 1.02 thru 2.60
    Single Layer medium

====>   Volume Structure verification
    Read Volume Recognition Sequence
     64 read 4 blocks
    BEA01
    Start of Extended Area
     68 read 4 blocks
    NSR03
  ==>   Changed UDF Revision range from: 1.02 thru 2.60 to: 2.00 thru 2.60
-   because of "NSR03 descriptor"
     72 read 4 blocks
    TEA01
     76 read 4 blocks
    End of Extended Area
    End of Volume Recognition Sequence


    Reading Volume Information
    256 read block
    AVDP at 256 (MVDS: 96, RVDS: 3913721)
    First Tag Serial Number: 2
    !\colorbox{yellow}{AVDP error: Main or Reserve Volume Descriptor Sequence Extent}!
-           !\colorbox{yellow}{has extent length less than 16 logical blocks (8192 bytes)}!
-           !\colorbox{yellow}{Main: 8192 bytes, Reserve: 3072 bytes, UDF 2.2.3.1+2}!
3913471 read block
    AVDP at N-256   (MVDS: 96, RVDS: 3913721)
    !\colorbox{yellow}{AVDP error: Main or Reserve Volume Descriptor Sequence Extent}!
-           !\colorbox{yellow}{has extent length less than 16 logical blocks (8192 bytes)}!
-           !\colorbox{yellow}{Main: 8192 bytes, Reserve: 3072 bytes, UDF 2.2.3.1+2}!
3913727 read block
    AVDP at N   (MVDS: 96, RVDS: 3913721)
    !\colorbox{yellow}{AVDP error: Main or Reserve Volume Descriptor Sequence Extent}!
-           !\colorbox{yellow}{has extent length less than 16 logical blocks (8192 bytes)}!
-           !\colorbox{yellow}{Main: 8192 bytes, Reserve: 3072 bytes, UDF 2.2.3.1+2}!

    Number of AVDPs: 3, AVDPs at  256,  N-256,  N

====>   Read Main VDS extent:      96, length:   8192
     96 read block
    PVD   VDS Number: 1
    PVD   Recording Time: 2017-05-05 17:58:30.010400 +02:00
    PVD   Volume Identifier    : "UDF Volume"
    PVD   Volume Set Identifier: "113A1E01 UDF Volume Set"
  ==>   PVD  344 New Entity Identifier (regid):
    Application Entity Identifier
      <empty>
  ==>   PVD  388 New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Microsoft Windows"
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
  ==>   Add PVD to VDS info
     97 read block
    PD    VDS Number: 2, Partition Number: 8192
  ==>   PD   24  New Entity Identifier (regid):
    Application Entity Identifier
      Identifier         : "+NSR03"
    Unallocated Space Bitmap
  ==>   Add PD to VDS info, partition number: 8192
     98 read block
    LVD   VDS Number: 3
    LVD   Logical Volume Identifier: "windows7_udf_r2.01"
  ==>   LVD  216 New Entity Identifier (regid):
    Domain Entity Identifier
      Identifier         : "*OSTA UDF Compliant"
      UDF revision       : 2.01
  ==>   Changed UDF Revision range from: 2.00 thru 2.60 to: 2.01 only
-   because of "Domain EntityID UDF revision"
      Domain flags       : #00
    LVD   FSD at: (0,p0)
  ==>   Add LVD to VDS info
     99 read block
    USD   VDS Number: 4, nmb of ADs: 6
     1: location      76 thru        95,       20 blocks
     2: location     112 thru       159,       48 blocks
     3: location     176 thru       255,       80 blocks
     4: location     257 thru       287,       31 blocks
     5: location 3913440 thru   3913470,       31 blocks
     6: location 3913472 thru   3913720,      249 blocks
  ==>   Add USD to VDS info
    100 read block
    IUVD  VDS Number: 5
    IUVD EntityID Identifier: "*UDF LV Info"
  ==>   IUVD 20  New Entity Identifier (regid):
    UDF Entity Identifier
      Identifier         : "*UDF LV Info"
      UDF revision       : 2.01
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    UDF IUVD Logical Volume Identifier : "windows7_udf_r2.01"
    UDF IUVD LVInfo1: <undefined>
    UDF IUVD LVInfo2: <undefined>
    UDF IUVD LVInfo3: <undefined>
  ==>   Add IUVD to VDS info
    101 read block
    TD  

====>   Read Reserve VDS extent: 3913721, length:   3072
3913721 read block
    PVD   VDS Number: 1
    PVD   Recording Time: 2017-05-05 17:58:30.010400 +02:00
    PVD   Volume Identifier    : "UDF Volume"
    PVD   Volume Set Identifier: "113A1E01 UDF Volume Set"
  ==>   Add PVD to VDS info
3913722 read block
    PD    VDS Number: 2, Partition Number: 8192
    Unallocated Space Bitmap
  ==>   Add PD to VDS info, partition number: 8192
3913723 read block
    LVD   VDS Number: 3
    LVD   Logical Volume Identifier: "windows7_udf_r2.01"
    LVD   FSD at: (0,p0)
  ==>   Add LVD to VDS info
3913724 read block
    USD   VDS Number: 4, nmb of ADs: 6
     1: location      76 thru        95,       20 blocks
     2: location     112 thru       159,       48 blocks
     3: location     176 thru       255,       80 blocks
     4: location     257 thru       287,       31 blocks
     5: location 3913440 thru   3913470,       31 blocks
     6: location 3913472 thru   3913720,      249 blocks
  ==>   Add USD to VDS info
3913725 read block
    IUVD  VDS Number: 5
    IUVD EntityID Identifier: "*UDF LV Info"
    UDF IUVD Logical Volume Identifier : "windows7_udf_r2.01"
    UDF IUVD LVInfo1: <undefined>
    UDF IUVD LVInfo2: <undefined>
    UDF IUVD LVInfo3: <undefined>
  ==>   Add IUVD to VDS info
3913726 read block
    TD  

====>   Check equivalence of Main VDS and Reserve VDS

  ==>   Main and Reserve VDS are equivalent

====>   Check Main VDS. Summary:
     PVD VDS Number  1
     LVD VDS Number  3
     USD VDS Number  4
      PD VDS Number  2
    IUVD VDS Number  5  ID: "*UDF LV Info"
       5 prevailing VDS descriptors found


  ==>   Using Main VDS

  ==>   Checking VDS 'far apart' allocation for Main and Reserve VDS.

   =>   Volume Descriptor Sequence 'far apart' test summary:
-         Main VDS LBA range:         96  thru        111,   1 extent
-      Reserve VDS LBA range:    3913721  thru    3913726,   1 extent
-     lowest packet distance:  244601 ECC packets (100.0% of remaining Volume Space)
-        test margin level 1:   24500 ECC packets ( 10.0% of remaining Volume Space)
-        test margin level 2:   61200 ECC packets ( 25.0% of remaining Volume Space)
-          Main VDS    Reserve VDS    ECC packet distance
-              111        3913721       244601                      


====>   Checking Logical Volume: "windows7_udf_r2.01"

    Prevailing Partition Descriptors:
      pNmb: 8192, start:   288, length: 3913152, access: overwritable

    LVD Partition Maps:
      p0: Physical Partition Map (Type 1), pNmb: 8192

  ==>   Changed medium WR type from unknown to overwritable
-           because of partition access type
  ==>   Changed medium SE type from unknown to nonsequential
-           because of no Virtual Partition found


    Mounted Partitions:
-   p0: Physical, pNmb: 8192, blocks:     288 thru 3913439, access: overwritable
-             logical blocks:       0 thru 3913151

  ==>   Changed medium CL type from unknown finalization state to finalized
-           because of more than one AVDP found

    Read LVID sequence extent: 160, length: 8192
    160 read block
    LVID  - Close
    LVID Recording Time: 2017-05-08 18:01:57 +02:00
    161 read block
    TD  

    Next UniqueID: #0000000000000001,
    from LVID Logical Volume Header Descriptor.

    !\colorbox{yellow}{Error: Next UniqueID lower 32 bits value less than 16, UDF 3.2.1.1.}!

  ==>   p0: read Unallocated or Freed Partition Space Sets
        Unallocated Space Bitmap extent: 956 blocks
    320 read block
    321 read 955 blocks
    SBD 
    SBD  10     Note: Descriptor CRC Length: 8. This is the recommended value
-             according to errata DCN-5108 for UDF 2.50 and lower.
    p0: Space set found
    --

    Read FSD sequence extent: (0,p0), length:    512

    288 read block
    FSD   FSN: 0,  FSDN: 0
    FSD   Logical Volume Identifier: "windows7_udf_r2.01"
    FSD         File Set Identifier: "UDF Volume Set"
    FSD   Copyright File Identifier: <undefined>
    FSD    Abstract File Identifier: <undefined>
    FSD           Root Directory at: (988,p0)
    FSD  System Stream Directory at: <undefined>

====>   Volume identifiers summary:

        PVD:         Volume Identifier  [32]: "UDF Volume"
        PVD:     Volume Set Identifier [128]: "113A1E01 UDF Volume Set"
        LVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
       IUVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD:       File Set Identifier  [32]: "UDF Volume Set"

====>   File Structure verification

    Read Root Directory
   1276 read block
    EFE  file type DIR    name: <root>
    !\colorbox{yellow}{EFE  8   Error: Descriptor CRC: \#4958, expected: \#7AD0, ECMA 3/7.2.6, 4/7.2.6}!
-        name: <root>
  ==>   EFE  168 New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Linux UDFFS"
      OS Class       : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
    EFE  216 Embedded data, 152 bytes

  ==>   (max) depth:  1  1  Expand directory: <root>

    EFE  216 Verify embedded FIDs, 152 bytes
    FID   cid:       name: /<parent FID>, refers to: <root>
    FID   cid:   8   name: "gtd.mp4"
    !\colorbox{yellow}{FID  32  Error: UniqueID:         \#00000010}!
-          !\colorbox{yellow}{Next UniqueID: \#0000000000000001}!
-        !\colorbox{yellow}{FID UniqueID shall be less than Next UniqueID,}!
-        !\colorbox{yellow}{UDF 3.2.1.1, ECMA 4/14.15.1.}!
-        name: "gtd.mp4"
    FID   cid:   8   name: "2017-01-16-191632.webm"
    !\colorbox{yellow}{FID  32  Error: UniqueID:         \#00000011}!
-         !\colorbox{yellow}{ Next UniqueID: \#0000000000000001}!
-        !\colorbox{yellow}{FID UniqueID shall be less than Next UniqueID,}!
-        !\colorbox{yellow}{UDF 3.2.1.1, ECMA 4/14.15.1.}!
-        name: "2017-01-16-191632.webm"
    Add FIDs to directory hierarchy and read FEs
    289 read block
    EFE  file type FILE   name: "gtd.mp4"
    !\colorbox{yellow}{EFE  200 Error: UniqueID: \#0000000000000010}!
-          !\colorbox{yellow}{Next UniqueID: \#0000000000000001}!
-        !\colorbox{yellow}{EFE UniqueID shall be less than Next UniqueID,}!
-        !\colorbox{yellow}{UDF 3.2.1.1, ECMA 4/14.15.1.}!
-        name: "gtd.mp4"
    cnt:  extent type,      size,  location,part,     body, total alloc
      1: short_ad   0  327345425      39131 0    327345425  327345664
   1277 read block
    EFE  file type FILE   name: "2017-01-16-191632.webm"
    !\colorbox{yellow}{EFE  200 Error: UniqueID: \#0000000000000011}!
-          !\colorbox{yellow}{Next UniqueID: \#0000000000000001}!
-        !\colorbox{yellow}{EFE UniqueID shall be less than Next UniqueID,}!
-        !\colorbox{yellow}{UDF 3.2.1.1, ECMA 4/14.15.1.}!
-        name: "2017-01-16-191632.webm"
    cnt:  extent type,      size,  location,part,     body, total alloc
      1: long_ad    0    9830400        990 0      9830400    9830400
      2: long_ad    1       1024      20190 0      9830400    9831424

Directory: <root>

.d.p.e..........:..rwx:..rwx:..rwx DIR   1 2017-05-05 15:58        152 /<parent FID>, refers to: <root>
.....S..........:..rwx:..rwx:..rwx FILE  1 2009-11-12 19:46  327345425 "gtd.mp4"
.....L..........:..rw.:..r..:..r.. FILE  1 2017-05-05 16:15    9830400 "2017-01-16-191632.webm"

    file body read: "gtd.mp4"
  39419 fake read 639347 blocks
    file body read: "2017-01-16-191632.webm"
   1278 fake read 19200 blocks
    file tail read: "2017-01-16-191632.webm"
  20478 fake read 2 blocks

    Expand complete, max depth  1 for directory: <root>
-              2 files   0 directories
-    overall total:    2 files   1 directory  

    Maximum directory depth: 1

    End of directory tree expansion
    Excluding deleted FIDs with cleared ICB

====>   Testing File Link Count by cross reference of 4 paths.
    File Link Count errors will be identified here by the
    physical address of the File Entry as well as all
    paths identifying the File Entry.
    The physical address of the File Entry is also shown in
    the informational read block messages above.
    Note that errors found here may have been reported before
    or may be caused by other previously reported errors.

====>   Testing free Volume Space in USD Allocation Descriptors

====>   Build Partition Space Bitmaps.
    Also check structures that overlap with partition space.

====>   Partition Allocation summary :

 ===>   Physical Partition p0:  size 3913152 blocks, overwritable
                blocks     288 thru 3913439

  ==>   Compare partition p0 calculated bitmap to recorded Space Set
      using: Unallocated Space Bitmap

      !\colorbox{yellow}{Error: 658551 used blocks marked as unallocated or freed}!
    289   logical block        1
   1277   logical block      989 thru    20191,   19203 blocks
  39419   logical block    39131 thru   678477,  639347 blocks

      No unused blocks marked as allocated.

====>   Final LVID verification
    Close LVID
  ==>   overwritable Physical Partition p0 Space summary:
                      Partition Length    : 3913152
                 LVID Partition Size      : 3913152
                 LVID Partition Free Space: 3912194
       Unallocated Space Bitmap free space: 3912194
              Verifier expected free space: 3253643
        Used by UDF but unallocated blocks:  658551

    !\colorbox{yellow}{LVID 80  FreeSpaceTable error: Physical Partition p0 Free Space: 3912194,}!
-        !\colorbox{yellow}{expected: 3253643, see Space summary above and}!
-        !\colorbox{yellow}{maybe use -showalloc output, UDF 2.2.6.2, ECMA 3/10.10.}!
-   Note: The verifier may be unable to find the correct values for
-         some of these LVID/VAT tests because of previous errors.

  ==>          LVID status summary:
    Last modification Time    : 2017-05-08 18:01:57 +02:00 (east of UTC)
    Last written Developer Id : "*Microsoft Windows"
    Next UniqueID             : #0000000000000001 => from LVID
    max used FE  UniqueID     : #0000000000000011
    max used FID UniqueID     :         #00000011
    Number of Files           :        0
    Number of Directories     :        0
    Min UDF Read   Revision   : UDF 2.01
    Min UDF Write  Revision   : UDF 2.01
    Max UDF Write  Revision   : UDF 2.01
        Medium UDF Revision   : UDF 2.01

    !\colorbox{yellow}{LVID 120 Error: Number of Files: 0, expected: 2, UDF 2.2.6.4.}!
    !\colorbox{yellow}{LVID 124 Error: Number of Directories: 0, expected: 1, UDF 2.2.6.4.}!

====>   Testing uniqueness of relevant UniqueIDs.


    Test complete
    Elapsed time : 00:00

====>   Volume identifiers summary:

        PVD:         Volume Identifier  [32]: "UDF Volume"
        PVD:     Volume Set Identifier [128]: "113A1E01 UDF Volume Set"
        LVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
       IUVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD:       File Set Identifier  [32]: "UDF Volume Set"

====>   Encountered EntityID (regid) summary:

 count  EntityID

    3   Domain Entity Identifier
      Identifier         : "*OSTA UDF Compliant"
      UDF revision       : 2.01
      Domain flags       : #00
    2   UDF Entity Identifier
      Identifier         : "*UDF LV Info"
      UDF revision       : 2.01
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    3   Implementation Entity Identifier
      Identifier         : "*Linux UDFFS"
      OS Class       : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
    9   Implementation Entity Identifier
      Identifier         : "*Microsoft Windows"
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    2   Application Entity Identifier
      <empty>
    2   Application Entity Identifier
      Identifier         : "+NSR03"

  These EntityIDs are also shown above when read for the first time

====>   Final verify status report

  Final UDF Revision range: 2.01 only

  File System info
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 16
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : overwritable
  medium SE type    : nonsequential
  medium CL type    : finalized

  Summed file body sizes: 337175825 bytes   (321.5559 Mbytes)

    Error count:   8    total occurrences:    13  -> search for   "error:"
  Warning count:   1    total occurrences:     1  -> search for "warning:"

  Additional notes may have been printed:     -> search for    "note:"

  Disclaimer:
-   The number of errors and warnings is an indication only.
-   There is no guarantee that the number of errors and
-   warnings as shown by the UDF verifier is correct.
\end{lstlisting}
\pagebreak
\begin{lstlisting}[frame=single,caption={Výsledek kontroly poškozeného média referenčním programem \texttt{udfct} po pokusu o jeho opravu po \texttt{CHKDSK} mým nástrojem \texttt{udffsck}},label=lst:udfct-chkdsk-po-oprave,basicstyle=\ttfamily\scriptsize, keywordstyle=\color{black}\bfseries\underbar,nolol,numbers=left,texcl=false,escapechar=!]
UDF Conformance Testing Application
(c) Koninklijke Philips Electronics N.V. 1999-2006
Application version : 1.5r4 distribution bin
   UCT Core version : 1.5r4 distribution bin
       platform : Linux - with scsi support

Command:
  ./udf_test
Generic options parsing:

Medium info options parsing:
    -blocksize 512

Device options parsing:
    /dev/sdb

No image configuration file /dev/sdb.cfg


Created image device
  image file blocks : 3913728  /dev/sdb
     blocks, bytes  : 3913728  2003828736


'-image' device Medium Info:
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 0
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : unknown
  medium SE type    : unknown
  medium CL type    : unknown finalization state

=> Warning: Undefined (ECC) blocking factor, set to 16.
-       Please specify "-ecclength <n>" to enable the verifier to do
-       a better job. Media that do not have ECC or fixed size packets
-       must specify: -ecclength 1

Inspect 1 block for presence of VAT or AVDP
starting at block: 3913727

  ==>   read cache: max 32 buffers of 32 sectors, total 512 Kb
3913727         1 ok block read
3913727 AVDP    (MVDS: 96, RVDS: 3913721)

last AVDP at 3913727 (N)

    Single Layer medium

Verification start medium info
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 16
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : unknown
  medium SE type    : unknown
  medium CL type    : unknown finalization state

====>   Start verification
    Start time   : 2017-05-09 13:19:12 +02:00 (east of UTC)
    Verbose level: 100
    Message limit: 20
    Fake read enabled
    Read cache enabled
    Initial UDF Revision range: 1.02 thru 2.60
    Single Layer medium

====>   Volume Structure verification
    Read Volume Recognition Sequence
     64 read 4 blocks
    BEA01
    Start of Extended Area
     68 read 4 blocks
    NSR03
  ==>   Changed UDF Revision range from: 1.02 thru 2.60 to: 2.00 thru 2.60
-   because of "NSR03 descriptor"
     72 read 4 blocks
    TEA01
     76 read 4 blocks
    End of Extended Area
    End of Volume Recognition Sequence


    Reading Volume Information
    256 read block
    AVDP at 256 (MVDS: 96, RVDS: 3913721)
    First Tag Serial Number: 2
3913471 read block
    AVDP at N-256   (MVDS: 96, RVDS: 3913721)
3913727 read block
    AVDP at N   (MVDS: 96, RVDS: 3913721)

    Number of AVDPs: 3, AVDPs at  256,  N-256,  N

====>   Read Main VDS extent:      96, length:   8192
     96 read block
    PVD   VDS Number: 1
    PVD   Recording Time: 2017-05-05 17:58:30.010400 +02:00
    PVD   Volume Identifier    : "UDF Volume"
    PVD   Volume Set Identifier: "113A1E01 UDF Volume Set"
  ==>   PVD  344 New Entity Identifier (regid):
    Application Entity Identifier
      <empty>
  ==>   PVD  388 New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Microsoft Windows"
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
  ==>   Add PVD to VDS info
     97 read block
    PD    VDS Number: 2, Partition Number: 8192
  ==>   PD   24  New Entity Identifier (regid):
    Application Entity Identifier
      Identifier         : "+NSR03"
    Unallocated Space Bitmap
  ==>   Add PD to VDS info, partition number: 8192
     98 read block
    LVD   VDS Number: 3
    LVD   Logical Volume Identifier: "windows7_udf_r2.01"
  ==>   LVD  216 New Entity Identifier (regid):
    Domain Entity Identifier
      Identifier         : "*OSTA UDF Compliant"
      UDF revision       : 2.01
  ==>   Changed UDF Revision range from: 2.00 thru 2.60 to: 2.01 only
-   because of "Domain EntityID UDF revision"
      Domain flags       : #00
    LVD   FSD at: (0,p0)
  ==>   Add LVD to VDS info
     99 read block
    USD   VDS Number: 4, nmb of ADs: 6
     1: location      76 thru        95,       20 blocks
     2: location     112 thru       159,       48 blocks
     3: location     176 thru       255,       80 blocks
     4: location     257 thru       287,       31 blocks
     5: location 3913440 thru   3913470,       31 blocks
     6: location 3913472 thru   3913720,      249 blocks
  ==>   Add USD to VDS info
    100 read block
    IUVD  VDS Number: 5
    IUVD EntityID Identifier: "*UDF LV Info"
  ==>   IUVD 20  New Entity Identifier (regid):
    UDF Entity Identifier
      Identifier         : "*UDF LV Info"
      UDF revision       : 2.01
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    UDF IUVD Logical Volume Identifier : "windows7_udf_r2.01"
    UDF IUVD LVInfo1: <undefined>
    UDF IUVD LVInfo2: <undefined>
    UDF IUVD LVInfo3: <undefined>
  ==>   Add IUVD to VDS info
    101 read block
    TD  

====>   Read Reserve VDS extent: 3913721, length:   8192
    !\colorbox{yellow}{Error: Last sector 3913736 of VDS extent beyond Volume Space, ECMA 3/8.5.}!
3913721 read block
    PVD   VDS Number: 1
    PVD   Recording Time: 2017-05-05 17:58:30.010400 +02:00
    PVD   Volume Identifier    : "UDF Volume"
    PVD   Volume Set Identifier: "113A1E01 UDF Volume Set"
  ==>   Add PVD to VDS info
3913722 read block
    PD    VDS Number: 2, Partition Number: 8192
    Unallocated Space Bitmap
  ==>   Add PD to VDS info, partition number: 8192
3913723 read block
    LVD   VDS Number: 3
    LVD   Logical Volume Identifier: "windows7_udf_r2.01"
    LVD   FSD at: (0,p0)
  ==>   Add LVD to VDS info
3913724 read block
    USD   VDS Number: 4, nmb of ADs: 6
     1: location      76 thru        95,       20 blocks
     2: location     112 thru       159,       48 blocks
     3: location     176 thru       255,       80 blocks
     4: location     257 thru       287,       31 blocks
     5: location 3913440 thru   3913470,       31 blocks
     6: location 3913472 thru   3913720,      249 blocks
  ==>   Add USD to VDS info
3913725 read block
    IUVD  VDS Number: 5
    IUVD EntityID Identifier: "*UDF LV Info"
    UDF IUVD Logical Volume Identifier : "windows7_udf_r2.01"
    UDF IUVD LVInfo1: <undefined>
    UDF IUVD LVInfo2: <undefined>
    UDF IUVD LVInfo3: <undefined>
  ==>   Add IUVD to VDS info
3913726 read block
    TD  

====>   Check equivalence of Main VDS and Reserve VDS

  ==>   Main and Reserve VDS are equivalent

====>   Check Main VDS. Summary:
     PVD VDS Number  1
     LVD VDS Number  3
     USD VDS Number  4
      PD VDS Number  2
    IUVD VDS Number  5  ID: "*UDF LV Info"
       5 prevailing VDS descriptors found


  ==>   Using Main VDS

  ==>   Checking VDS 'far apart' allocation for Main and Reserve VDS.

   =>   Volume Descriptor Sequence 'far apart' test summary:
-         Main VDS LBA range:         96  thru        111,   1 extent
-      Reserve VDS LBA range:    3913721  thru    3913736,   1 extent
-     lowest packet distance:  244601 ECC packets (100.0% of remaining Volume Space)
-        test margin level 1:   24500 ECC packets ( 10.0% of remaining Volume Space)
-        test margin level 2:   61200 ECC packets ( 25.0% of remaining Volume Space)
-          Main VDS    Reserve VDS    ECC packet distance
-              111        3913721       244601                      


====>   Checking Logical Volume: "windows7_udf_r2.01"

    Prevailing Partition Descriptors:
      pNmb: 8192, start:   288, length: 3913152, access: overwritable

    LVD Partition Maps:
      p0: Physical Partition Map (Type 1), pNmb: 8192

  ==>   Changed medium WR type from unknown to overwritable
-           because of partition access type
  ==>   Changed medium SE type from unknown to nonsequential
-           because of no Virtual Partition found


    Mounted Partitions:
-   p0: Physical, pNmb: 8192, blocks:     288 thru 3913439, access: overwritable
-             logical blocks:       0 thru 3913151

  ==>   Changed medium CL type from unknown finalization state to finalized
-           because of more than one AVDP found

    Read LVID sequence extent: 160, length: 8192
    160 read block
    LVID  - Close
    LVID Recording Time: 2017-05-09 12:32:10.768729 +02:00
  ==>   LVID 88  New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Microsoft Windows     "
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
      Implementation Use : #00 #00 #06 #01 #01 #00
    161 read block
    TD  

    Next UniqueID: #0000000000000013,
    from LVID Logical Volume Header Descriptor.


  ==>   p0: read Unallocated or Freed Partition Space Sets
        Unallocated Space Bitmap extent: 956 blocks
    320 read block
    321 read 955 blocks
    SBD 
    SBD  10     Note: Descriptor CRC Length: 8. This is the recommended value
-             according to errata DCN-5108 for UDF 2.50 and lower.
    p0: Space set found
    --

    Read FSD sequence extent: (0,p0), length:    512

    288 read block
    FSD   FSN: 0,  FSDN: 0
    FSD   Logical Volume Identifier: "windows7_udf_r2.01"
    FSD         File Set Identifier: "UDF Volume Set"
    FSD   Copyright File Identifier: <undefined>
    FSD    Abstract File Identifier: <undefined>
    FSD           Root Directory at: (988,p0)
    FSD  System Stream Directory at: <undefined>

====>   Volume identifiers summary:

        PVD:         Volume Identifier  [32]: "UDF Volume"
        PVD:     Volume Set Identifier [128]: "113A1E01 UDF Volume Set"
        LVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
       IUVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD:       File Set Identifier  [32]: "UDF Volume Set"

====>   File Structure verification

    Read Root Directory
   1276 read block
    EFE  file type DIR    name: <root>
    EFE  216 Embedded data, 260 bytes

  ==>   (max) depth:  1  1  Expand directory: <root>

    EFE  216 Verify embedded FIDs, 260 bytes
    FID   cid:       name: /<parent FID>, refers to: <root>
    FID   cid:   8   name: "gtd.mp4"
    FID   cid:   8   name: "2017-01-16-191632.webm"
    FID   cid: 255 D name: "Nov#00E1 slo#017Eka"
    Note: deleted FID, compression ID 255
- ==>   Message printed once, ignored from now.
    FID   cid:   8   name: "asd"
    Add FIDs to directory hierarchy and read FEs
    289 read block
    EFE  file type FILE   name: "gtd.mp4"
  ==>   EFE  168 New Entity Identifier (regid):
    Implementation Entity Identifier
      Identifier         : "*Linux UDFFS"
      OS Class       : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
    cnt:  extent type,      size,  location,part,     body, total alloc
      1: short_ad   0  327345425      39131 0    327345425  327345664
   1277 read block
    EFE  file type FILE   name: "2017-01-16-191632.webm"
    cnt:  extent type,      size,  location,part,     body, total alloc
      1: long_ad    0    9830400        990 0      9830400    9830400
      2: long_ad    1       1024      20190 0      9830400    9831424
    290 read block
    EFE  file type DIR    name: "asd"
    EFE  216 Embedded data, 40 bytes

Directory: <root>

.d.p.e..........:..rwx:..rwx:..rwx DIR   2 2017-05-09 10:32        260 /<parent FID>, refers to: <root>
.....S..........:..rwx:..rwx:..rwx FILE  1 2009-11-12 19:46  327345425 "gtd.mp4"
.....L..........:..rw.:..r..:..r.. FILE  1 2017-05-05 16:15    9830400 "2017-01-16-191632.webm"
.dD.............      <unused FID>                                     "Nov#00E1 slo#017Eka"
.d...e..........:darwx:darwx:darwx DIR   1 2017-05-09 10:32         40 "asd"

    file body read: "gtd.mp4"
  39419 fake read 639347 blocks
    file body read: "2017-01-16-191632.webm"
   1278 fake read 19200 blocks
    file tail read: "2017-01-16-191632.webm"
  20478 fake read 2 blocks

  ==>   (max) depth:  2  2  Expand directory: "asd"

    EFE  216 Verify embedded FIDs, 40 bytes
    FID   cid:       name: "asd"/<parent FID>, refers to: <root>
    Add FIDs to directory hierarchy and read FEs

Directory: /"asd"

.d.p.e..........:..rwx:..rwx:..rwx DIR   2 2017-05-09 10:32        260 "asd"/<parent FID>, refers to: <root>


    Expand complete, max depth  2 for directory: "asd"
-              0 files   0 directories

    Expand complete, max depth  2 for directory: <root>
-              2 files   1 directory  
-    overall total:    2 files   2 directories

    Maximum directory depth: 2

    End of directory tree expansion
    Excluding deleted FIDs with cleared ICB

====>   Testing File Link Count by cross reference of 6 paths.
    File Link Count errors will be identified here by the
    physical address of the File Entry as well as all
    paths identifying the File Entry.
    The physical address of the File Entry is also shown in
    the informational read block messages above.
    Note that errors found here may have been reported before
    or may be caused by other previously reported errors.

====>   Testing free Volume Space in USD Allocation Descriptors

====>   Build Partition Space Bitmaps.
    Also check structures that overlap with partition space.

====>   Partition Allocation summary :

 ===>   Physical Partition p0:  size 3913152 blocks, overwritable
                blocks     288 thru 3913439

  ==>   Compare partition p0 calculated bitmap to recorded Space Set
      using: Unallocated Space Bitmap

      !\colorbox{yellow}{Error: 2 used blocks marked as unallocated or freed}!
  20478   logical block    20190 thru    20191,       2 blocks

      No unused blocks marked as allocated.

====>   Final LVID verification
    Close LVID
  ==>   overwritable Physical Partition p0 Space summary:
                      Partition Length    : 3913152
                 LVID Partition Size      : 3913152
                 LVID Partition Free Space: 3253644
       Unallocated Space Bitmap free space: 3253644
              Verifier expected free space: 3253642
        Used by UDF but unallocated blocks:       2

    !\colorbox{yellow}{LVID 80  FreeSpaceTable error: Physical Partition p0 Free Space: 3253644,}!
-        !\colorbox{yellow}{expected: 3253642, see Space summary above and}!
-        !\colorbox{yellow}{maybe use -showalloc output, UDF 2.2.6.2, ECMA 3/10.10.}!
-   Note: The verifier may be unable to find the correct values for
-         some of these LVID/VAT tests because of previous errors.

  ==>          LVID status summary:
    Last modification Time    : 2017-05-09 12:32:10.768729 +02:00 (east of UTC)
    Last written Developer Id : "*Microsoft Windows     "
    Next UniqueID             : #0000000000000013 => from LVID
    max used FE  UniqueID     : #0000000000000012
    max used FID UniqueID     :         #00000012
    Number of Files           :        2
    Number of Directories     :        2
    Min UDF Read   Revision   : UDF 2.01
    Min UDF Write  Revision   : UDF 2.01
    Max UDF Write  Revision   : UDF 2.01
        Medium UDF Revision   : UDF 2.01


====>   Testing uniqueness of relevant UniqueIDs.


    Test complete
    Elapsed time : 00:00

====>   Volume identifiers summary:

        PVD:         Volume Identifier  [32]: "UDF Volume"
        PVD:     Volume Set Identifier [128]: "113A1E01 UDF Volume Set"
        LVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
       IUVD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD: Logical Volume Identifier [128]: "windows7_udf_r2.01"
        FSD:       File Set Identifier  [32]: "UDF Volume Set"

====>   Encountered EntityID (regid) summary:

 count  EntityID

    3   Domain Entity Identifier
      Identifier         : "*OSTA UDF Compliant"
      UDF revision       : 2.01
      Domain flags       : #00
    2   UDF Entity Identifier
      Identifier         : "*UDF LV Info"
      UDF revision       : 2.01
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    2   Implementation Entity Identifier
      Identifier         : "*Linux UDFFS"
      OS Class       : #04  UNIX
      OS Identifier      : #05  UNIX - Linux
    8   Implementation Entity Identifier
      Identifier         : "*Microsoft Windows"
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
    3   Implementation Entity Identifier
      Identifier         : "*Microsoft Windows     "
      OS Class       : #06  Windows NT
      OS Identifier      : #00  Windows NT - generic
      Implementation Use : #00 #00 #06 #01 #01 #00
    2   Application Entity Identifier
      <empty>
    2   Application Entity Identifier
      Identifier         : "+NSR03"

  These EntityIDs are also shown above when read for the first time

====>   Final verify status report

  Final UDF Revision range: 2.01 only

  File System info
  last valid block  : 3913727   Volume Space: 1.8662 Gbyte
  block size        : 512
  (ECC) blocking factor : 16
  nmb of sessions   : 1
  verify session    : 1
  session starts    : 0       
  medium WR type    : overwritable
  medium SE type    : nonsequential
  medium CL type    : finalized

  Summed file body sizes: 337175825 bytes   (321.5559 Mbytes)

    Error count:   3    total occurrences:     3  -> search for   "error:"
  Warning count:   1    total occurrences:     1  -> search for "warning:"

  Additional notes may have been printed:     -> search for    "note:"

  Disclaimer:
-   The number of errors and warnings is an indication only.
-   There is no guarantee that the number of errors and
-   warnings as shown by the UDF verifier is correct.
\end{lstlisting}
\pagebreak
\begin{lstlisting}[frame=single,caption={Výsledek kontroly poškozeného média programem \texttt{fsck\_udf}},label=lst:fsck-udf-mac,basicstyle=\ttfamily\scriptsize, keywordstyle=\color{black}\bfseries\underbar,nolol,numbers=left,texcl=false]
fsck_udf: * * * File <0, 989> seems to have already-allocated blocks! * * *
fsck_udf: * * * File <0, 989> seems to have fewer blocks (2116354) than expected (19202) * * *
fsck_udf: * * * File <0, 989> seems to have fewer data bytes (1083573248) than expected (9830400) * * *
fsck_udf: * * * File <0, 989> seems to have fewer bytes (1083573248) than expected (9830400) * * *
1 errors total
** Checking Hierarchy
** Filesystem error: Bad extent in file
** Filesystem error: 2017-01-16-191632.webm
** Filesystem is dirty and non-repairable
LVID = {
    blkNum = 128
    numFiles = 2
    numDirs = 1
    minReadRevision = 201
    minWriteRevision = 201
    maxWriteRevision = 201
    numFreeBlks[0] = 3253614
    numFreeBlks[1] = 0
    numFreeBlks[2] = 0
    numTotalFreeBlks = 3253614
    numPart = 1
    nextUniqueId = 0
}
\end{lstlisting}

\chapter{Obsah přiloženého archivu}

Pro úspěšnou kompilaci je potřeba mít nainstalovaný nástroj \texttt{autotools}, \texttt{gcc} verze 4.9 a vyšší a knihovnu \texttt{cmocka} ve verzi 1.1.0. Nástroj je aktuálně testován vůči distribucím Debian a Ubuntu. V tuto chvíli je potřeba pro správnou funkci potřeba little-endian procesor. Tento požadavek bude před dokončením odstraněn.
\dirtree{%.
.1 /\DTcomment{kořenový adresář archivu}.
.2 AUTHORS.
.2 autogen.sh\DTcomment{Skript pro kompilaci balíku}.
.2 cdrwtool\DTcomment{Adresář se zdrojovými kódy nástroje \texttt{cdrwtool}}.
.2 configure.ac.
.2 COPYING.
.2 doc\DTcomment{Adresář s dokumentacemi k jednotlivým nástrojům}.
.2 Doxyfile.
.2 ChangeLog.
.2 include\DTcomment{Adresář se sdílenými hlavičkovými soubory}.
.3 bswap.h.
.3 \detokenize{ecma_167.h}\DTcomment{Soubor se strukturami podle ECMA-167}.
.3 libudffs.h\DTcomment{Soubor s definicemi funkcí ze sdílené knihovny \texttt{libtool}}.
.3 \detokenize{osta_udf.h}\DTcomment{Soubor se strukturami podle OSTA UDF dokumentace}.
.3 \detokenize{udf_endian.h}.
.3 \detokenize{udf_lib.h}.
.2 INSTALL.
.2 libudffs\DTcomment{Adresář se zdrojovými kódy sdílené knihovy \texttt{libudffs}}.
.2 Makefile.am.
.2 mkudffs\DTcomment{Adresář se zdrojovými kódy nástroje \texttt{mkudffs}}.
.2 NEWS.
.2 pktsetup.
.2 README.
.2 README.md.
.2 TODO.
.2 udffsck\DTcomment{Adresář se zdrojovými kódy nástroje \texttt{udffsck}}.
.3 \detokenize{ecma_119.h}\DTcomment{Soubor s vybranými hlavičkami standardu ECMA-119.}.
.3 main.c\DTcomment{Hlavní soubor programu. Obsahuje kromě funkce main také detekci VRS.}.
.3 Makefile.am.
.3 options.c\DTcomment{Parser vstupních parametrů a nápověda.}.
.3 options.h.
.3 test.c\DTcomment{Zdrojový soubor pro unit-testy.}.
.3 udffsck.c\DTcomment{V tomto souboru je jádro celého programu.}.
.3 udffsck.h.
.3 utils.c\DTcomment{Podpůrné funkce (například tisk tagů)}.
.3 utils.h.
.2 wrudf\DTcomment{Adresář se zdrojovými kódy nástroje \texttt{wrudf}}.
}
